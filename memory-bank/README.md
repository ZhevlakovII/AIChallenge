# Memory Bank — руководство и структура

Цель банка памяти — быть устойчивым источником истины для контекста разработки: решений, договорённостей, текущего фокуса, прогресса и терминов. Здесь хранится «долгая память» между сессиями и участниками.

Последнее обновление: 2025-11-21

## 1) Структура каталога

```
memory-bank/
├─ README.md                  ← вы здесь
├─ projectbrief.md            ← краткий проектный бриф (источник правды по целям/границам)
├─ productContext.md          ← продуктовый контекст (клиенты, ценность, сценарии)
├─ techContext.md             ← техконтекст (стек, окружения, переменные, интеграции)
├─ systemPatterns.md          ← архитектурные паттерны и принципы, ссылки на ADR
├─ activeContext.md           ← текущий фокус, ближайшие шаги, риски/блокеры
├─ progress.md                ← журнал прогресса (дневник сессий/вех)
├─ glossary.md                ← глоссарий терминов проекта
├─ decisions/                 ← ADR (Architecture Decision Records)
│  └─ .gitkeep
├─ sessions/                  ← заметки по сессиям (по дате)
│  └─ 2025-11-21.md           ← пример/первая запись для этой сессии
├─ _templates/                ← шаблоны для заметок, ADR и записей прогресса
│  ├─ ADR-template.md
│  ├─ context-note-template.md
│  ├─ session-template.md
│  └─ progress-entry-template.md
└─ _archive/                  ← архив устаревших материалов
   └─ .gitkeep
```

Смежные источники знаний:
- docs/human/* — инженерные практики и стандарты (архитектура, тестирование, безопасность и т.д.)
- docs/llm/* — правила для LLM, системные подсказки, шаблоны генерации
- memory-bank/projectbrief.md — бриф с целями, границами и критическими путями

## 2) Назначение ключевых файлов

- projectbrief.md — базовый документ: цели, архитектура на высоком уровне, критические пути (чат, MCP, настройки, напоминания), риски, метрики успеха.
- productContext.md — портреты пользователей, проблематика, ключевые сценарии, JTBD/OKR (если есть), артефакты продукта.
- techContext.md — стек (KMP/Ktor/Koin/Compose и пр.), окружения, переменные, инфраструктура, CI/CD, доступы, MCP-сервера.
- systemPatterns.md — архитектурные и проектные решения, принципы, ссылки на ADR и последствия trade-off’ов.
- activeContext.md — текущий фокус (активные эпики/задачи), ближайшие шаги, риски/блокеры, договорённости по приоритетам.
- progress.md — журнал прогресса (по дате); краткие записи: что сделано, что в работе, что помешало.
- glossary.md — ключевые термины и определения в контексте проекта.
- decisions/ — папка ADR: каждая запись фиксирует конкретное решение, его контекст и последствия.
- sessions/ — заметки по конкретным рабочим сессиям, датированные YYYY-MM-DD.
- _templates/ — шаблоны для единообразия структуры заметок/решений/логов.
- _archive/ — сюда перемещаются устаревшие документы вместо удаления (для трассируемости).

## 3) Правила ведения

1) Единый источник правды
- Если информация расходится между файлами, приоритет: projectbrief.md → ADR (decisions/*) → профильный контекстный файл → README.md.
- Документы с коротким жизненным циклом (activeContext.md, sessions/*, progress.md) должны ссылаться на стабильные источники (docs/human/*, ADR, projectbrief.md).

2) Трассируемость и ссылки
- В каждом документе по возможности давайте ссылки на смежные: ADR, проектный бриф, соответствующие разделы docs/human и docs/llm.
- Для решений — всегда ссылка на ADR (или создайте новый ADR, если решения ещё нет).

3) Консистентность и формат
- Даты: YYYY-MM-DD.
- Язык: русский (кроме интерфейсных имён и кодовых терминов).
- Структура: используйте заголовки H2/H3 и чек-листы для ясности.
- В шаблонах изменяйте только секции «Заполнить», не меняя постоянные подсказки.

4) Обновление и архивирование
- Устаревшие материалы перемещайте в _archive/ с примечанием: что заменило и почему.
- Внесли важное решение — закрепите ADR, дайте ссылку в systemPatterns.md.

## 4) ADR (Architecture Decision Records)

Когда оформлять:
- Влияние на архитектуру, безопасность, масштабирование, DX, производительность, совместимость.
- Выбор/замена ключевой зависимости, протокола или интеграции.

Как оформлять:
- decisions/YYYYMMDD-<кратко-о-решении>.md
- Используйте _templates/ADR-template.md
- Минимальные разделы: Контекст → Решение → Последствия → Альтернативы → Ссылки
- В systemPatterns.md добавьте ссылку на ADR и краткую выжимку.

Статусы:
- Proposed → Accepted/Rejected → Superseded (ссылка на заменивший ADR)

## 5) Сессии и активный контекст

- sessions/YYYY-MM-DD.md — фиксируйте цели сессии, итог, принятые решения, блокеры, ссылки на изменения.
- activeContext.md — единая точка текущего фокуса (обновляется в приоритете перед многими мелкими сессионными заметками).
- progress.md — краткие записи «что сделано/в работе/помешало» по датам (1–5 пунктов, не больше).

Рекомендация: в конце каждой сессии обновляйте progress.md и ссылкайте на sessions/<date>.md.

## 6) Глоссарий

- glossary.md — добавляйте термины по мере появления (особенно бизнес-термины и доменные понятия).
- Избегайте дублирования: если термин подробно описан в docs/human/ProjectStructure.md или других документах, давайте ссылку.

## 7) Связанные документы (обязательные ссылки)

- Бриф: ./projectbrief.md
- Человеческая документация (инженерные практики):
  - ../docs/human/Architecture.md
  - ../docs/human/ProjectStructure.md
  - ../docs/human/FeatureDevelopmentGuide.md
  - ../docs/human/TestingStrategy.md
  - ../docs/human/Security.md
  - ../docs/human/Logging-Metrics.md
  - ../docs/human/CodingStandards.md
  - ../docs/human/Data-Persistence.md
  - ../docs/human/ErrorHandling.md
- LLM-правила и шаблоны:
  - ../docs/llm/system_prompt.md
  - ../docs/llm/code_generation_rules.md
  - ../docs/llm/file_paths_policy.md
  - ../docs/llm/maintenance_rules.md
  - ../docs/llm/templates/*

## 8) Как вносить изменения (рабочий процесс)

1) Определите тип изменения:
   - Решение → ADR в decisions/
   - Долговременный контекст → productContext/techContext/systemPatterns/glossary
   - Краткоживущий контекст → activeContext/sessions/progress
2) Обновите соответствующий файл(ы).
3) Добавьте перекрёстные ссылки (на ADR, бриф, профильные документы).
4) При необходимости переместите устаревшее в _archive/.
5) Зафиксируйте изменения коммитом с осмысленным сообщением.

## 9) Стартовые задачи на инициализацию (чек-лист)

- [ ] Создать шаблоны в _templates/
- [ ] Создать productContext.md, techContext.md, systemPatterns.md, activeContext.md, glossary.md
- [ ] Инициализировать progress.md (первая запись)
- [ ] Создать sessions/2025-11-21.md
- [ ] Подготовить decisions/.gitkeep и _archive/.gitkeep
- [ ] Перепроверить перекрёстные ссылки
- [ ] Рекурсивно верифицировать итоговую структуру
