# Правила поддержки и актуализации LLM-пакета

Документ регламентирует обновление LLM-ориентированных материалов: системного промпта, правил генерации кода, политики путей, набора знаний (knowledge) и шаблонов. Согласован с AIChallenge-StyleGuide.md, .clinerules/Project-rules.md и общей документацией (docs/human/*).

Содержание:
- Область действия
- Принципы версионирования и совместимости
- Процесс внесения изменений (workflow)
- Обновление knowledge-пакетов
- Обновление шаблонов (templates)
- Проверки качества и валидация
- Чек-лист релиза LLM-пакета

## Область действия

LLM-пакет включает:
- system_prompt.md — ядро правил.
- code_generation_rules.md — формализованные правила генерации кода.
- file_paths_policy.md — политика путей/структур.
- maintenance_rules.md — текущий документ.
- knowledge/* — сжатые знания (архитектура, модули, модели данных).
- templates/*.kt.md — шаблоны кода для автогенерации.

## Принципы версионирования и совместимости

- Семантическое версионирование (SemVer) для LLM-пакета:
  - MAJOR — несовместимые изменения правил/структуры (требуют адаптации генерации).
  - MINOR — добавление новых правил/шаблонов, обратная совместимость.
  - PATCH — правки формулировок/опечатки/мелкие уточнения.
- Ветка документации: изменения публикуются вместе с соответствующими правками в кодовой базе (если релевантно).
- Указывать номер версии и дату в заголовке system_prompt.md (по мере необходимости).

## Процесс внесения изменений (workflow)

1) Инициирование:
   - Основания: изменение архитектуры/структуры проекта; новый модуль/фича; выявленные проблемы с генерацией; согласованные улучшения.
   - Создать задачу с описанием проблемы и ожидаемым эффектом.

2) Подготовка:
   - Проанализировать затронутые файлы LLM-пакета.
   - Сформировать план: список файлов, краткое описание правок и их причины.

3) Изменения:
   - Вносить правки точечно.
   - Сохранять терминологию и инварианты (Чистая архитектура, MVI, DTO-изоляция, KMP).
   - Обновить cross-links (ссылки между документами) при необходимости.

4) Ревью:
   - Проверка на непротиворечивость с docs/human/*.
   - Проверка, что примеры и пути соответствуют реальному коду (inventory).

5) Публикация:
   - Обновить docs/INDEX.md при добавлении новых файлов.
   - Обновить README.md при необходимости (ссылки на разделы документации).

## Обновление knowledge-пакетов

- knowledge/architecture.md:
  - Содержит краткое описание слоёв, MVI-поток, DI-модули и KMP-source sets.
  - Обновлять при изменении архитектурных принципов или точек интеграции.

- knowledge/modules.md:
  - Перечень модулей и фич, роли, ключевые файлы, DI-модули. Ссылки на inventory.
  - Обновлять при добавлении/изменении модулей/фич.

- knowledge/data_models.md:
  - Краткие описания DTO/Domain-моделей, маппинг и инварианты (DTO не в UI/Domain).
  - Обновлять при изменениях моделей/мапперов.

Правила:
- Держать тексты максимально короткими (1–2 экрана).
- Ссылки на исходники и docs/human/* — обязательны.

## Обновление шаблонов (templates)

- templates/*.kt.md — минимальные и совместимые скелеты:
  - ViewModel (MVI), UseCase (интерфейс/Impl), Repository (контракт/Impl), Mapper, DI-модуль фичи, Navigation.
- При изменениях в коде-фреймворках (например, переход с collectAsState на collectAsStateWithLifecycle) — обновить шаблон.
- Проверить, что шаблоны соответствуют file_paths_policy.md.

## Проверки качества и валидация

- Структурная валидность:
  - Все ссылки в документах актуальны (на файлы/каталоги/разделы).
  - Маркдаун без битых якорей, код-блоки с указанием языка.

- Архитектурная валидность:
  - Инварианты Чистой архитектуры соблюдены.
  - DTO-изоляция и KMP-размещение — корректны.

- Практическая валидность:
  - Применить шаблон на «песочнице» (новая фича) и проверить сборку.
  - Верифицировать MVI-контракт (State/Event/Effect), DI и навигацию.

## Чек-лист релиза LLM-пакета

- [ ] Обновлён system_prompt.md и code_generation_rules.md (при необходимости).
- [ ] Обновлены knowledge/* в соответствии с текущей структурой проекта.
- [ ] Шаблоны templates/*.kt.md валидны и компонуемы.
- [ ] Индекс docs/INDEX.md содержит ссылки на новые/изменённые документы.
- [ ] Нет противоречий с docs/human/*.
- [ ] Inventory актуален (docs/inventory/project_inventory.json).
- [ ] Версия LLM-пакета инкрементирована согласно SemVer (при необходимости).
